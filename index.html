<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZSC - AIæ–—åœ°ä¸»</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #1a5f23, #0d3011);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 20px);
        }
        
        header {
            text-align: center;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        h1 {
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            color: #ffd700;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            flex-shrink: 0;
        }
        
        .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .player-name {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .player-cards {
            font-size: 0.9rem;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            overflow: hidden;
        }
        
        .players {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
            flex-shrink: 0;
        }
        
        .player {
            width: 30%;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 8px;
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .toggle-cards {
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 3px;
            padding: 2px 5px;
            font-size: 0.7rem;
            cursor: pointer;
        }
        
        .player-cards-area {
            min-height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            transition: max-height 0.3s ease;
            overflow: hidden;
        }
        
        .player-cards-area.folded {
            max-height: 30px;
        }
        
        .center-area {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            min-height: 100px;
            flex-shrink: 0;
        }
        
        .played-cards {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            min-height: 80px;
        }
        
        .player-hand {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            min-height: 120px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            flex-shrink: 0;
            max-height: 150px;
            overflow-y: auto;
        }
        
        /* ä¿®å¤å¡ç‰Œæ ·å¼ - ç¡®ä¿æ–‡å­—ä¸è¶…å‡º */
        .card {
            width: 60px; /* å¢åŠ å®½åº¦ */
            height: 84px; /* å¢åŠ é«˜åº¦ */
            background: white;
            border-radius: 5px;
            margin: 3px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px; /* å¢åŠ å†…è¾¹è· */
            color: #333;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.8rem;
            position: relative;
            overflow: hidden; /* ç¡®ä¿å†…å®¹ä¸è¶…å‡º */
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card.selected {
            transform: translateY(-10px);
            border: 2px solid #ffd700;
        }
        
        .card.red {
            color: #e74c3c;
        }
        
        .card.black {
            color: #2c3e50;
        }
        
        .card-value {
            font-size: 1rem; /* è°ƒæ•´å­—ä½“å¤§å° */
            font-weight: bold;
            line-height: 1;
            text-align: left;
        }
        
        .card-suit {
            font-size: 1.5rem; /* è°ƒæ•´èŠ±è‰²å¤§å° */
            align-self: center;
            line-height: 1;
        }
        
        .card-bottom-value {
            font-size: 1rem;
            font-weight: bold;
            line-height: 1;
            text-align: right;
            transform: rotate(180deg);
            align-self: flex-end;
        }
        
        .card-back {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
        }
        
        .controls-container {
            width: 100%;
            position: relative;
            flex-shrink: 0;
            margin-top: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        button {
            padding: 10px 15px;
            font-size: 0.9rem;
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 80px;
            flex: 1;
        }
        
        button:hover {
            background: #ffed4e;
            transform: scale(1.05);
        }
        
        button:disabled {
            background: #777;
            cursor: not-allowed;
            transform: none;
        }
        
        .message {
            text-align: center;
            font-size: 1rem;
            margin: 10px 0;
            min-height: 20px;
            color: #ffd700;
        }
        
        .game-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            max-height: 100px;
            overflow-y: auto;
            margin-top: 10px;
            flex-shrink: 0;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 3px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
        }
        
        /* è€åƒç³»ç»Ÿæ ·å¼ */
        .cheat-system {
            background: rgba(255, 215, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
            flex-shrink: 0;
        }
        
        .cheat-input {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .cheat-input input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .cheat-toggle {
            background: #ff6b6b;
            width: 100%;
        }
        
        /* ç§»åŠ¨ç«¯ç‰¹å®šæ ·å¼ */
        @media (max-width: 768px) {
            .container {
                height: 100vh;
                padding: 5px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .game-info {
                padding: 5px;
                font-size: 0.7rem;
            }
            
            .player-cards {
                font-size: 0.8rem;
            }
            
            .player {
                padding: 5px;
            }
            
            /* ç§»åŠ¨ç«¯å¡ç‰Œå°ºå¯¸è°ƒæ•´ */
            .card {
                width: 50px;
                height: 70px;
                margin: 2px;
                padding: 4px;
            }
            
            .card-value {
                font-size: 0.9rem;
            }
            
            .card-suit {
                font-size: 1.2rem;
            }
            
            .card-bottom-value {
                font-size: 0.9rem;
            }
            
            .controls {
                display: flex !important;
                flex-direction: row;
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
                gap: 5px;
            }
            
            button {
                flex: 0 0 auto;
                min-width: 70px;
                font-size: 0.8rem;
                padding: 8px 10px;
            }
            
            .player-hand {
                min-height: 100px;
                max-height: 120px;
            }
            
            .game-area {
                overflow-y: auto;
            }
            
            .player-cards-area.folded {
                max-height: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .card {
                width: 45px;
                height: 63px;
                padding: 3px;
            }
            
            .card-value {
                font-size: 0.8rem;
            }
            
            .card-suit {
                font-size: 1rem;
            }
            
            .card-bottom-value {
                font-size: 0.8rem;
            }
            
            button {
                min-width: 60px;
                font-size: 0.7rem;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ZSC - AIæ–—åœ°ä¸»</h1>
        </header>
        
        <div class="game-info">
            <div class="player-info">
                <div class="player-name">ç©å®¶</div>
                <div class="player-cards">å‰©ä½™: <span id="player-card-count">17</span></div>
            </div>
            <div class="player-info">
                <div class="player-name">å›åˆ: <span id="current-turn">ç©å®¶</span></div>
                <div class="player-cards">åº•ç‰Œ: <span id="bottom-cards">3</span></div>
            </div>
            <div class="player-info">
                <div class="player-name">åœ°ä¸»: <span id="landlord">æœªç¡®å®š</span></div>
                <div class="player-cards">è½®æ•°: <span id="round-count">0</span></div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="players">
                <div class="player">
                    <div class="player-header">
                        <div class="player-name">AIç©å®¶1</div>
                        <button class="toggle-cards" data-ai="ai1">æŠ˜å </button>
                    </div>
                    <div class="player-cards">å‰©ä½™: <span id="ai1-card-count">17</span></div>
                    <div class="player-cards-area folded" id="ai1-cards">
                        <!-- AIç©å®¶çš„ç‰ŒèƒŒé¢æ˜¾ç¤º -->
                    </div>
                </div>
                
                <div class="player">
                    <div class="player-header">
                        <div class="player-name">AIç©å®¶2</div>
                        <button class="toggle-cards" data-ai="ai2">æŠ˜å </button>
                    </div>
                    <div class="player-cards">å‰©ä½™: <span id="ai2-card-count">17</span></div>
                    <div class="player-cards-area folded" id="ai2-cards">
                        <!-- AIç©å®¶çš„ç‰ŒèƒŒé¢æ˜¾ç¤º -->
                    </div>
                </div>
            </div>
            
            <div class="center-area">
                <div class="message" id="game-message">æ¸¸æˆå¼€å§‹ï¼è¯·å«åœ°ä¸»ğŸ¤“ğŸ¤“</div>
                <div class="played-cards" id="played-cards">
                    <!-- å·²å‡ºçš„ç‰Œä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                </div>
            </div>
            
            <div class="player-hand" id="player-hand">
                <!-- ç©å®¶çš„æ‰‹ç‰Œä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
            
            <!-- è€åƒç³»ç»Ÿ -->
            <div class="cheat-system" id="cheat-system">
                <div class="cheat-input">
                    <input type="text" id="cheat-input" placeholder="è¾“å…¥æƒ³è¦çš„ç‰Œï¼Œå¦‚: å¤§ç‹, çº¢æ¡ƒA, é»‘æ¡ƒ2">
                    <button id="cheat-add">æ·»åŠ </button>
                </div>
                <button class="cheat-toggle" id="cheat-toggle">éšè—è€åƒç³»ç»Ÿ</button>
            </div>
            
            <div class="controls-container">
                <div class="controls" id="controls">
                    <button id="call-landlord">å«åœ°ä¸»</button>
                    <button id="pass-turn">ä¸å‡º</button>
                    <button id="play-cards">å‡ºç‰Œ</button>
                    <button id="hint">æç¤º</button>
                    <button id="restart">é‡æ–°å¼€å§‹</button>
                    <button id="show-cheat">è€åƒç³»ç»Ÿ</button>
                </div>
            </div>
        </div>
        
        <div class="game-log">
            <h3>æ¸¸æˆè®°å½•</h3>
            <div id="log-entries">
                <div class="log-entry">æ¸¸æˆå¼€å§‹ğŸ˜¡ğŸ˜¡</div>
            </div>
        </div>
    </div>

    <script>
        // æ‰‘å…‹ç‰Œæ•°æ® - ä¿®å¤èŠ±è‰²æ˜¾ç¤º
        const suits = ['â™¥', 'â™¦', 'â™£', 'â™ '];
        const values = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2'];
        const specialCards = ['å°ç‹', 'å¤§ç‹'];
        
        // ç‰Œå€¼é¡ºåºï¼ˆä»å°åˆ°å¤§ï¼‰
        const cardOrder = {
            '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, 
            '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14, '2': 15,
            'å°ç‹': 16, 'å¤§ç‹': 17
        };
        
        // èŠ±è‰²æ˜ å°„
        const suitMap = {
            'çº¢æ¡ƒ': 'â™¥', 'çº¢': 'â™¥', 'â™¥': 'â™¥',
            'æ–¹å—': 'â™¦', 'æ–¹': 'â™¦', 'â™¦': 'â™¦',
            'æ¢…èŠ±': 'â™£', 'æ¢…': 'â™£', 'â™£': 'â™£',
            'é»‘æ¡ƒ': 'â™ ', 'é»‘': 'â™ ', 'â™ ': 'â™ '
        };
        
        // ç‰Œå€¼æ˜ å°„
        const valueMap = {
            '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9', 
            '10': '10', 'J': 'J', 'Q': 'Q', 'K': 'K', 'A': 'A', '2': '2',
            'å°ç‹': 'å°ç‹', 'å¤§ç‹': 'å¤§ç‹'
        };
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            deck: [],
            playerHand: [],
            ai1Hand: [],
            ai2Hand: [],
            bottomCards: [],
            playedCards: [],
            currentPlayer: 'player', // player, ai1, ai2
            landlord: null,
            lastPlayed: null,
            lastPlayer: null,
            gamePhase: 'bidding', // bidding, playing, ended
            roundCount: 0
        };
        
        // DOMå…ƒç´ 
        const playerHandElement = document.getElementById('player-hand');
        const ai1CardsElement = document.getElementById('ai1-cards');
        const ai2CardsElement = document.getElementById('ai2-cards');
        const playedCardsElement = document.getElementById('played-cards');
        const gameMessageElement = document.getElementById('game-message');
        const playerCardCountElement = document.getElementById('player-card-count');
        const ai1CardCountElement = document.getElementById('ai1-card-count');
        const ai2CardCountElement = document.getElementById('ai2-card-count');
        const currentTurnElement = document.getElementById('current-turn');
        const landlordElement = document.getElementById('landlord');
        const roundCountElement = document.getElementById('round-count');
        const bottomCardsElement = document.getElementById('bottom-cards');
        const logEntriesElement = document.getElementById('log-entries');
        const controlsElement = document.getElementById('controls');
        const cheatSystemElement = document.getElementById('cheat-system');
        const cheatInputElement = document.getElementById('cheat-input');
        const cheatAddButton = document.getElementById('cheat-add');
        const cheatToggleButton = document.getElementById('cheat-toggle');
        const showCheatButton = document.getElementById('show-cheat');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆ›å»ºä¸€å‰¯ç‰Œ
            gameState.deck = [];
            
            // æ·»åŠ æ™®é€šç‰Œ
            for (let suit of suits) {
                for (let value of values) {
                    gameState.deck.push({
                        suit: suit,
                        value: value,
                        color: (suit === 'â™¥' || suit === 'â™¦') ? 'red' : 'black'
                    });
                }
            }
            
            // æ·»åŠ å¤§å°ç‹
            gameState.deck.push({ value: 'å°ç‹', color: 'black', isJoker: true });
            gameState.deck.push({ value: 'å¤§ç‹', color: 'red', isJoker: true });
            
            // æ´—ç‰Œ
            shuffleDeck();
            
            // å‘ç‰Œ
            dealCards();
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.playedCards = [];
            gameState.lastPlayed = null;
            gameState.lastPlayer = null;
            gameState.currentPlayer = 'player';
            gameState.landlord = null;
            gameState.gamePhase = 'bidding';
            gameState.roundCount = 0;
            
            // éšè—è€åƒç³»ç»Ÿ
            cheatSystemElement.style.display = 'none';
            
            // æ›´æ–°UI
            updateUI();
            
            // æ·»åŠ æ—¥å¿—
            addLogEntry("æ¸¸æˆå¼€å§‹ï¼Œè¯·å«åœ°ä¸»ğŸ¤“ğŸ¤“");
            gameMessageElement.textContent = "æ¸¸æˆå¼€å§‹ï¼è¯·å«åœ°ä¸»ğŸ¤“ğŸ¤“";
        }
        
        // æ´—ç‰Œ
        function shuffleDeck() {
            for (let i = gameState.deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
            }
        }
        
        // å‘ç‰Œ
        function dealCards() {
            gameState.playerHand = [];
            gameState.ai1Hand = [];
            gameState.ai2Hand = [];
            
            // å‘51å¼ ç‰Œï¼ˆæ¯äºº17å¼ ï¼‰
            for (let i = 0; i < 51; i++) {
                const card = gameState.deck.pop();
                if (i % 3 === 0) {
                    gameState.playerHand.push(card);
                } else if (i % 3 === 1) {
                    gameState.ai1Hand.push(card);
                } else {
                    gameState.ai2Hand.push(card);
                }
            }
            
            // åº•ç‰Œ
            gameState.bottomCards = gameState.deck;
            
            // æ’åºæ‰‹ç‰Œ
            sortHand(gameState.playerHand);
            sortHand(gameState.ai1Hand);
            sortHand(gameState.ai2Hand);
        }
        
        // æ’åºæ‰‹ç‰Œ
        function sortHand(hand) {
            hand.sort((a, b) => {
                const aValue = getCardValue(a);
                const bValue = getCardValue(b);
                
                if (aValue !== bValue) {
                    return aValue - bValue; // ä»å°åˆ°å¤§æ’åº
                }
                
                // åŒå€¼æŒ‰èŠ±è‰²æ’åº
                const suitOrder = {'â™ ': 4, 'â™¥': 3, 'â™£': 2, 'â™¦': 1};
                return suitOrder[a.suit] - suitOrder[b.suit];
            });
        }
        
        // å«åœ°ä¸»
        function callLandlord() {
            if (gameState.gamePhase !== 'bidding') return;
            
            gameState.landlord = 'player';
            gameState.playerHand = gameState.playerHand.concat(gameState.bottomCards);
            sortHand(gameState.playerHand);
            gameState.bottomCards = [];
            gameState.gamePhase = 'playing';
            gameState.currentPlayer = 'player';
            
            addLogEntry("ç©å®¶æˆä¸ºåœ°ä¸»ğŸ˜‹ğŸ˜‹");
            gameMessageElement.textContent = "ä½ æ˜¯åœ°ä¸»ï¼è¯·å‡ºç‰ŒğŸ¤”ğŸ¤”";
            
            updateUI();
        }
        
        // AIå«åœ°ä¸»ï¼ˆç®€åŒ–ç‰ˆï¼Œéšæœºå†³å®šï¼‰
        function aiBid(aiPlayer) {
            if (gameState.gamePhase !== 'bidding') return;
            
            // ç®€å•é€»è¾‘ï¼šå¦‚æœæ‰‹ç‰Œä¸­æœ‰2ä¸ª2æˆ–ä»¥ä¸Šï¼Œå°±å«åœ°ä¸»
            const hand = aiPlayer === 'ai1' ? gameState.ai1Hand : gameState.ai2Hand;
            let count2 = 0;
            for (let card of hand) {
                if (card.value === '2') count2++;
            }
            
            if (count2 >= 2 || Math.random() > 0.7) {
                gameState.landlord = aiPlayer;
                const handToUpdate = aiPlayer === 'ai1' ? gameState.ai1Hand : gameState.ai2Hand;
                handToUpdate.push(...gameState.bottomCards);
                sortHand(handToUpdate);
                gameState.bottomCards = [];
                gameState.gamePhase = 'playing';
                gameState.currentPlayer = aiPlayer;
                
                addLogEntry(`AI${aiPlayer === 'ai1' ? '1' : '2'}æˆä¸ºåœ°ä¸»`);
                gameMessageElement.textContent = `AI${aiPlayer === 'ai1' ? '1' : '2'}æ˜¯åœ°ä¸»ï¼`;
                
                updateUI();
                // AIåœ°ä¸»å…ˆå‡ºç‰Œ
                setTimeout(aiPlay, 1000, aiPlayer);
            } else {
                // ä¸å«åœ°ä¸»ï¼Œè½®åˆ°ä¸‹ä¸€ä¸ªç©å®¶
                if (aiPlayer === 'ai1') {
                    gameState.currentPlayer = 'ai2';
                    setTimeout(aiBid, 1000, 'ai2');
                } else {
                    // å¦‚æœæ‰€æœ‰AIéƒ½ä¸å«ï¼Œç©å®¶è‡ªåŠ¨æˆä¸ºåœ°ä¸»
                    callLandlord();
                }
            }
        }
        
        // ç©å®¶å‡ºç‰Œ
        function playCards() {
            if (gameState.gamePhase !== 'playing' || gameState.currentPlayer !== 'player') return;
            
            const selectedCards = getSelectedCards();
            if (selectedCards.length === 0) {
                gameMessageElement.textContent = "è¯·é€‰æ‹©è¦å‡ºçš„ç‰Œ";
                return;
            }
            
            // æ£€æŸ¥å‡ºç‰Œæ˜¯å¦åˆæ³•
            const playResult = isValidPlay(selectedCards, gameState.lastPlayed, gameState.lastPlayer === 'player');
            if (!playResult.valid) {
                gameMessageElement.textContent = playResult.message || "å‡ºç‰Œä¸ç¬¦åˆè§„åˆ™ï¼Œè¯·é‡æ–°é€‰æ‹©";
                return;
            }
            
            // ä»æ‰‹ç‰Œä¸­ç§»é™¤å·²å‡ºçš„ç‰Œ
            gameState.playerHand = gameState.playerHand.filter(card => !selectedCards.includes(card));
            
            // è®°å½•å‡ºçš„ç‰Œ
            gameState.playedCards = selectedCards;
            gameState.lastPlayed = selectedCards;
            gameState.lastPlayer = 'player';
            
            // æ›´æ–°å›åˆ
            gameState.roundCount++;
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.playerHand.length === 0) {
                endGame('player');
                return;
            }
            
            // è½®åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            gameState.currentPlayer = 'ai1';
            
            addLogEntry(`ç©å®¶å‡ºäº† ${describeCards(selectedCards)}`);
            updateUI();
            
            // AIå‡ºç‰Œ
            setTimeout(aiPlay, 1500, 'ai1');
        }
        
        // ä¸å‡º
        function passTurn() {
            if (gameState.gamePhase !== 'playing' || gameState.currentPlayer !== 'player') return;
            
            // å¦‚æœä¸Šå®¶ä¹Ÿæ˜¯è‡ªå·±ï¼Œä¸èƒ½ä¸å‡º
            if (gameState.lastPlayer === 'player') {
                gameMessageElement.textContent = "ä½ æ˜¯ä¸Šè½®çš„å‡ºç‰Œè€…ï¼Œå¿…é¡»å‡ºç‰Œ";
                return;
            }
            
            gameState.currentPlayer = 'ai1';
            addLogEntry("ç©å®¶é€‰æ‹©ä¸å‡º");
            updateUI();
            
            // AIå‡ºç‰Œ
            setTimeout(aiPlay, 1500, 'ai1');
        }
        
        // AIå‡ºç‰Œ - é‡å†™é€»è¾‘
        function aiPlay(aiPlayer) {
            if (gameState.gamePhase !== 'playing' || gameState.currentPlayer !== aiPlayer) return;
            
            const hand = aiPlayer === 'ai1' ? gameState.ai1Hand : gameState.ai2Hand;
            let cardsToPlay = [];
            
            // å¦‚æœä¸Šå®¶æ˜¯ç©å®¶ï¼Œä¸”ç©å®¶å‡ºäº†ç‰Œï¼Œå°è¯•å‹è¿‡
            if (gameState.lastPlayed && gameState.lastPlayer !== aiPlayer) {
                // æœ‰ä¸Šå®¶å‡ºçš„ç‰Œï¼Œå°è¯•å‹è¿‡
                cardsToPlay = findPlayableCards(hand, gameState.lastPlayed);
                
                // å¦‚æœæ‰¾ä¸åˆ°å¯å‹çš„ç‰Œï¼Œæ£€æŸ¥æ˜¯å¦èƒ½å‡ºç‚¸å¼¹
                if (cardsToPlay.length === 0) {
                    const lastPlayType = getPlayType(gameState.lastPlayed);
                    // å¦‚æœä¸Šå®¶å‡ºçš„æ˜¯ç‚¸å¼¹ï¼Œå¿…é¡»ç”¨æ›´å¤§çš„ç‚¸å¼¹å‹è¿‡
                    if (lastPlayType === 'bomb' || lastPlayType === 'rocket') {
                        cardsToPlay = findBombToBeat(hand, gameState.lastPlayed);
                    } else {
                        // å¦‚æœä¸æ˜¯ç‚¸å¼¹ï¼Œå¯ä»¥å‡ºç‚¸å¼¹å‹è¿‡
                        cardsToPlay = findBomb(hand);
                    }
                }
            } else {
                // è½®åˆ°è‡ªå·±å…ˆå‡ºï¼Œé€‰æ‹©æœ€ä¼˜å‡ºç‰Œç­–ç•¥
                cardsToPlay = findOptimalPlay(hand);
            }
            
            // å¦‚æœè¿˜æ˜¯æ²¡ç‰Œå¯å‡ºï¼Œé€‰æ‹©ä¸å‡º
            if (cardsToPlay.length === 0) {
                // æ£€æŸ¥æ˜¯å¦èƒ½ä¸å‡º
                if (gameState.lastPlayer === aiPlayer) {
                    // ä¸Šå®¶æ˜¯è‡ªå·±ï¼Œå¿…é¡»å‡ºç‰Œï¼Œå‡ºæœ€å°çš„å•å¼ 
                    cardsToPlay = [hand[0]];
                } else {
                    // ä¸å‡º
                    addLogEntry(`AI${aiPlayer === 'ai1' ? '1' : '2'}é€‰æ‹©ä¸å‡º`);
                    gameState.currentPlayer = aiPlayer === 'ai1' ? 'ai2' : 'player';
                    updateUI();
                    
                    if (gameState.currentPlayer === 'player') {
                        gameMessageElement.textContent = "è½®åˆ°ä½ äº†";
                    } else {
                        setTimeout(aiPlay, 1500, gameState.currentPlayer);
                    }
                    return;
                }
            }
            
            // ä»æ‰‹ç‰Œä¸­ç§»é™¤å·²å‡ºçš„ç‰Œ
            if (aiPlayer === 'ai1') {
                gameState.ai1Hand = gameState.ai1Hand.filter(card => !cardsToPlay.includes(card));
            } else {
                gameState.ai2Hand = gameState.ai2Hand.filter(card => !cardsToPlay.includes(card));
            }
            
            // è®°å½•å‡ºçš„ç‰Œ
            gameState.playedCards = cardsToPlay;
            gameState.lastPlayed = cardsToPlay;
            gameState.lastPlayer = aiPlayer;
            
            // æ›´æ–°å›åˆ
            gameState.roundCount++;
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if ((aiPlayer === 'ai1' && gameState.ai1Hand.length === 0) || 
                (aiPlayer === 'ai2' && gameState.ai2Hand.length === 0)) {
                endGame(aiPlayer);
                return;
            }
            
            // è½®åˆ°ä¸‹ä¸€ä¸ªç©å®¶
            gameState.currentPlayer = aiPlayer === 'ai1' ? 'ai2' : 'player';
            
            addLogEntry(`AI${aiPlayer === 'ai1' ? '1' : '2'}å‡ºäº† ${describeCards(cardsToPlay)}`);
            updateUI();
            
            if (gameState.currentPlayer === 'player') {
                gameMessageElement.textContent = "è½®åˆ°ä½ äº†";
            } else {
                setTimeout(aiPlay, 1500, gameState.currentPlayer);
            }
        }
        
        // æŸ¥æ‰¾å¯å‡ºçš„ç‰Œ
        function findPlayableCards(hand, lastPlayed) {
            const lastPlayType = getPlayType(lastPlayed);
            const lastValue = getCardValue(lastPlayed[0]);
            
            // æ ¹æ®ä¸Šå®¶å‡ºçš„ç‰Œå‹ï¼Œå¯»æ‰¾èƒ½å‹è¿‡çš„ç‰Œ
            if (lastPlayType === 'single') {
                // æ‰¾æ¯”ä¸Šå®¶å¤§çš„å•å¼ 
                for (let i = 0; i < hand.length; i++) {
                    if (getCardValue(hand[i]) > lastValue) {
                        return [hand[i]];
                    }
                }
            } else if (lastPlayType === 'pair') {
                // æ‰¾æ¯”ä¸Šå®¶å¤§çš„å¯¹å­
                for (let i = 0; i < hand.length - 1; i++) {
                    if (getCardValue(hand[i]) === getCardValue(hand[i+1]) && 
                        getCardValue(hand[i]) > lastValue) {
                        return [hand[i], hand[i+1]];
                    }
                }
            } else if (lastPlayType === 'triple') {
                // æ‰¾æ¯”ä¸Šå®¶å¤§çš„ä¸‰å¼ 
                for (let i = 0; i < hand.length - 2; i++) {
                    if (getCardValue(hand[i]) === getCardValue(hand[i+1]) && 
                        getCardValue(hand[i]) === getCardValue(hand[i+2]) &&
                        getCardValue(hand[i]) > lastValue) {
                        return [hand[i], hand[i+1], hand[i+2]];
                    }
                }
            } else if (lastPlayType === 'triple-with-single') {
                // æ‰¾æ¯”ä¸Šå®¶å¤§çš„ä¸‰å¸¦ä¸€
                const tripleValue = getCardValue(lastPlayed[0]);
                for (let i = 0; i < hand.length - 2; i++) {
                    if (getCardValue(hand[i]) === getCardValue(hand[i+1]) && 
                        getCardValue(hand[i]) === getCardValue(hand[i+2]) &&
                        getCardValue(hand[i]) > tripleValue) {
                        
                        // å¯»æ‰¾ä¸€ä¸ªå•å¼ 
                        for (let j = 0; j < hand.length; j++) {
                            if (j < i || j > i+2) {
                                return [hand[i], hand[i+1], hand[i+2], hand[j]];
                            }
                        }
                    }
                }
            } else if (lastPlayType === 'triple-with-pair') {
                // æ‰¾æ¯”ä¸Šå®¶å¤§çš„ä¸‰å¸¦äºŒ
                const tripleValue = getCardValue(lastPlayed[0]);
                for (let i = 0; i < hand.length - 2; i++) {
                    if (getCardValue(hand[i]) === getCardValue(hand[i+1]) && 
                        getCardValue(hand[i]) === getCardValue(hand[i+2]) &&
                        getCardValue(hand[i]) > tripleValue) {
                        
                        // å¯»æ‰¾ä¸€å¯¹
                        for (let j = 0; j < hand.length - 1; j++) {
                            if ((j < i || j > i+2) && getCardValue(hand[j]) === getCardValue(hand[j+1])) {
                                return [hand[i], hand[i+1], hand[i+2], hand[j], hand[j+1]];
                            }
                        }
                    }
                }
            } else if (lastPlayType === 'bomb') {
                // æ‰¾æ¯”ä¸Šå®¶å¤§çš„ç‚¸å¼¹
                return findBombToBeat(hand, lastPlayed);
            } else if (lastPlayType === 'rocket') {
                // ç‹ç‚¸æ— æ³•è¢«å‹è¿‡
                return [];
            }
            
            return [];
        }
        
        // æŸ¥æ‰¾ç‚¸å¼¹æ¥å‹è¿‡
        function findBombToBeat(hand, lastPlayed) {
            const lastValue = getCardValue(lastPlayed[0]);
            
            // æ‰¾æ›´å¤§çš„ç‚¸å¼¹
            for (let i = 0; i < hand.length - 3; i++) {
                if (getCardValue(hand[i]) === getCardValue(hand[i+1]) && 
                    getCardValue(hand[i]) === getCardValue(hand[i+2]) &&
                    getCardValue(hand[i]) === getCardValue(hand[i+3]) &&
                    getCardValue(hand[i]) > lastValue) {
                    return [hand[i], hand[i+1], hand[i+2], hand[i+3]];
                }
            }
            
            // æ‰¾ç‹ç‚¸
            let hasSmallJoker = false;
            let hasBigJoker = false;
            for (let card of hand) {
                if (card.value === 'å°ç‹') hasSmallJoker = true;
                if (card.value === 'å¤§ç‹') hasBigJoker = true;
            }
            if (hasSmallJoker && hasBigJoker) {
                return hand.filter(card => card.value === 'å°ç‹' || card.value === 'å¤§ç‹');
            }
            
            return [];
        }
        
        // æŸ¥æ‰¾ä»»æ„ç‚¸å¼¹
        function findBomb(hand) {
            // æ‰¾æ™®é€šç‚¸å¼¹
            for (let i = 0; i < hand.length - 3; i++) {
                if (getCardValue(hand[i]) === getCardValue(hand[i+1]) && 
                    getCardValue(hand[i]) === getCardValue(hand[i+2]) &&
                    getCardValue(hand[i]) === getCardValue(hand[i+3])) {
                    return [hand[i], hand[i+1], hand[i+2], hand[i+3]];
                }
            }
            
            // æ‰¾ç‹ç‚¸
            let hasSmallJoker = false;
            let hasBigJoker = false;
            for (let card of hand) {
                if (card.value === 'å°ç‹') hasSmallJoker = true;
                if (card.value === 'å¤§ç‹') hasBigJoker = true;
            }
            if (hasSmallJoker && hasBigJoker) {
                return hand.filter(card => card.value === 'å°ç‹' || card.value === 'å¤§ç‹');
            }
            
            return [];
        }
        
        // æŸ¥æ‰¾æœ€ä¼˜å‡ºç‰Œç­–ç•¥
        function findOptimalPlay(hand) {
            // ç­–ç•¥1: å¦‚æœæœ‰å•å¼ ï¼Œå‡ºæœ€å°çš„å•å¼ 
            if (hand.length > 0) {
                return [hand[0]];
            }
            
            return [];
        }
        
        // è·å–ç‰Œå‹
        function getPlayType(cards) {
            if (!cards || cards.length === 0) return 'pass';
            
            if (cards.length === 1) return 'single';
            
            if (cards.length === 2) {
                if (getCardValue(cards[0]) === getCardValue(cards[1])) {
                    return 'pair';
                }
                // ç‹ç‚¸
                if (cards[0].isJoker && cards[1].isJoker) {
                    return 'rocket';
                }
                return 'invalid';
            }
            
            if (cards.length === 3) {
                if (getCardValue(cards[0]) === getCardValue(cards[1]) && 
                    getCardValue(cards[1]) === getCardValue(cards[2])) {
                    return 'triple';
                }
                return 'invalid';
            }
            
            if (cards.length === 4) {
                // å¯èƒ½æ˜¯ä¸‰å¸¦ä¸€æˆ–ç‚¸å¼¹
                const values = cards.map(card => getCardValue(card));
                const valueCount = {};
                
                for (let value of values) {
                    valueCount[value] = (valueCount[value] || 0) + 1;
                }
                
                const counts = Object.values(valueCount);
                
                if (counts.includes(3) && counts.includes(1)) {
                    return 'triple-with-single';
                } else if (counts.includes(4)) {
                    return 'bomb';
                }
                
                return 'invalid';
            }
            
            if (cards.length === 5) {
                // å¯èƒ½æ˜¯ä¸‰å¸¦äºŒæˆ–é¡ºå­
                const values = cards.map(card => getCardValue(card));
                const valueCount = {};
                
                for (let value of values) {
                    valueCount[value] = (valueCount[value] || 0) + 1;
                }
                
                const counts = Object.values(valueCount);
                
                if (counts.includes(3) && counts.includes(2)) {
                    return 'triple-with-pair';
                }
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é¡ºå­
                values.sort((a, b) => a - b);
                let isStraight = true;
                for (let i = 1; i < values.length; i++) {
                    if (values[i] !== values[i-1] + 1) {
                        isStraight = false;
                        break;
                    }
                }
                
                if (isStraight && values[0] >= 3 && values[4] <= 14) { // 3åˆ°Açš„é¡ºå­
                    return 'straight';
                }
                
                return 'invalid';
            }
            
            return 'invalid';
        }
        
        // è·å–ç‰Œçš„å€¼ï¼ˆç”¨äºæ¯”è¾ƒï¼‰
        function getCardValue(card) {
            return cardOrder[card.value] || 0;
        }
        
        // æ£€æŸ¥å‡ºç‰Œæ˜¯å¦åˆæ³•
        function isValidPlay(selectedCards, lastPlayed, isSamePlayer) {
            // å¦‚æœé€‰æ‹©ä¸å‡º
            if (selectedCards.length === 0) {
                if (isSamePlayer) {
                    return { valid: false, message: "ä½ æ˜¯ä¸Šè½®çš„å‡ºç‰Œè€…ï¼Œå¿…é¡»å‡ºç‰Œ" };
                }
                return { valid: true };
            }
            
            // æ£€æŸ¥ç‰Œå‹
            const playType = getPlayType(selectedCards);
            if (playType === 'invalid') {
                return { valid: false, message: "ä¸æ˜¯æœ‰æ•ˆçš„ç‰Œå‹" };
            }
            
            // å¦‚æœæ˜¯ç‚¸å¼¹ï¼Œå¯ä»¥å‹è¿‡ä»»ä½•éç‚¸å¼¹ç‰Œ
            if (playType === 'bomb' || playType === 'rocket') {
                if (!lastPlayed || (getPlayType(lastPlayed) !== 'bomb' && getPlayType(lastPlayed) !== 'rocket')) {
                    return { valid: true };
                }
                // ç‚¸å¼¹æ¯”è¾ƒå¤§å°
                if (getCardValue(selectedCards[0]) > getCardValue(lastPlayed[0])) {
                    return { valid: true };
                }
                return { valid: false, message: "ç‚¸å¼¹ä¸å¤Ÿå¤§" };
            }
            
            // å¦‚æœä¸Šè½®æ˜¯è‡ªå·±å‡ºçš„ç‰Œï¼Œå¯ä»¥å‡ºä»»ä½•åˆæ³•ç‰Œå‹
            if (isSamePlayer || !lastPlayed) {
                return { valid: true };
            }
            
            // å¿…é¡»ä¸ä¸Šå®¶å‡ºçš„ç‰Œå‹ç›¸åŒä¸”æ›´å¤§
            const lastPlayType = getPlayType(lastPlayed);
            
            if (lastPlayType !== playType) {
                return { valid: false, message: "ç‰Œå‹ä¸åŒ¹é…" };
            }
            
            // æ¯”è¾ƒç‰Œçš„å¤§å°
            const lastValue = getCardValue(lastPlayed[0]);
            const currentValue = getCardValue(selectedCards[0]);
            
            if (currentValue > lastValue) {
                return { valid: true };
            }
            
            return { valid: false, message: "ç‰Œä¸å¤Ÿå¤§" };
        }
        
        // è·å–é€‰ä¸­çš„ç‰Œ
        function getSelectedCards() {
            const selectedCards = [];
            const cardElements = playerHandElement.querySelectorAll('.card.selected');
            
            for (let cardElement of cardElements) {
                const index = parseInt(cardElement.dataset.index);
                selectedCards.push(gameState.playerHand[index]);
            }
            
            return selectedCards;
        }
        
        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°ç©å®¶æ‰‹ç‰Œ
            playerHandElement.innerHTML = '';
            gameState.playerHand.forEach((card, index) => {
                const cardElement = createCardElement(card, index, true);
                playerHandElement.appendChild(cardElement);
            });
            
            // æ›´æ–°AIæ‰‹ç‰Œï¼ˆèƒŒé¢ï¼‰
            ai1CardsElement.innerHTML = '';
            for (let i = 0; i < gameState.ai1Hand.length; i++) {
                const cardBack = document.createElement('div');
                cardBack.className = 'card card-back';
                cardBack.textContent = 'â™ ';
                ai1CardsElement.appendChild(cardBack);
            }
            
            ai2CardsElement.innerHTML = '';
            for (let i = 0; i < gameState.ai2Hand.length; i++) {
                const cardBack = document.createElement('div');
                cardBack.className = 'card card-back';
                cardBack.textContent = 'â™ ';
                ai2CardsElement.appendChild(cardBack);
            }
            
            // æ›´æ–°å·²å‡ºçš„ç‰Œ
            playedCardsElement.innerHTML = '';
            gameState.playedCards.forEach(card => {
                const cardElement = createCardElement(card, -1, false);
                playedCardsElement.appendChild(cardElement);
            });
            
            // æ›´æ–°ç‰Œæ•°
            playerCardCountElement.textContent = gameState.playerHand.length;
            ai1CardCountElement.textContent = gameState.ai1Hand.length;
            ai2CardCountElement.textContent = gameState.ai2Hand.length;
            bottomCardsElement.textContent = gameState.bottomCards.length;
            
            // æ›´æ–°å½“å‰å›åˆ
            currentTurnElement.textContent = 
                gameState.currentPlayer === 'player' ? 'ç©å®¶' : 
                gameState.currentPlayer === 'ai1' ? 'AI1' : 'AI2';
            
            // æ›´æ–°åœ°ä¸»ä¿¡æ¯
            landlordElement.textContent = 
                gameState.landlord === 'player' ? 'ç©å®¶' : 
                gameState.landlord === 'ai1' ? 'AI1' : 
                gameState.landlord === 'ai2' ? 'AI2' : 'æœªç¡®å®š';
            
            // æ›´æ–°å›åˆæ•°
            roundCountElement.textContent = gameState.roundCount;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('call-landlord').disabled = gameState.gamePhase !== 'bidding';
            document.getElementById('pass-turn').disabled = gameState.gamePhase !== 'playing' || gameState.currentPlayer !== 'player';
            document.getElementById('play-cards').disabled = gameState.gamePhase !== 'playing' || gameState.currentPlayer !== 'player';
        }
        
        // åˆ›å»ºç‰Œå…ƒç´  - ä¿®å¤æ–‡å­—æ˜¾ç¤ºé—®é¢˜
        function createCardElement(card, index, selectable) {
            const cardElement = document.createElement('div');
            cardElement.className = `card ${card.color}`;
            
            if (card.isJoker) {
                cardElement.innerHTML = `
                    <div class="card-value">${card.value}</div>
                    <div class="card-suit">${card.value === 'å¤§ç‹' ? 'â˜…' : 'â˜†'}</div>
                    <div class="card-bottom-value">${card.value}</div>
                `;
            } else {
                cardElement.innerHTML = `
                    <div class="card-value">${card.value}</div>
                    <div class="card-suit">${card.suit}</div>
                    <div class="card-bottom-value">${card.value}</div>
                `;
            }
            
            if (selectable) {
                cardElement.dataset.index = index;
                cardElement.addEventListener('click', () => {
                    cardElement.classList.toggle('selected');
                });
            }
            
            return cardElement;
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame(winner) {
            gameState.gamePhase = 'ended';
            
            let message = '';
            if (winner === 'player') {
                message = 'æ­å–œï¼ä½ èµ¢äº†ï¼';
            } else {
                message = `æ¸¸æˆç»“æŸï¼${winner === 'ai1' ? 'AI1' : 'AI2'}èµ¢äº†ï¼`;
            }
            
            gameMessageElement.textContent = message;
            addLogEntry(message);
        }
        
        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(text) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = text;
            logEntriesElement.appendChild(logEntry);
            // ç¡®ä¿æ—¥å¿—è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                logEntriesElement.scrollTop = logEntriesElement.scrollHeight;
            }, 10);
        }
        
        // æè¿°å‡ºçš„ç‰Œ
        function describeCards(cards) {
            if (cards.length === 0) return "ä¸å‡º";
            
            if (cards.length === 1) {
                return cards[0].isJoker ? cards[0].value : `${cards[0].value}${cards[0].suit}`;
            }
            
            const playType = getPlayType(cards);
            if (playType === 'pair') {
                return `å¯¹${cards[0].value}`;
            } else if (playType === 'triple') {
                return `ä¸‰ä¸ª${cards[0].value}`;
            } else if (playType === 'triple-with-single') {
                return `ä¸‰å¸¦ä¸€ ${cards[0].value}`;
            } else if (playType === 'triple-with-pair') {
                return `ä¸‰å¸¦äºŒ ${cards[0].value}`;
            } else if (playType === 'bomb') {
                return `ç‚¸å¼¹ ${cards[0].value}`;
            } else if (playType === 'rocket') {
                return 'ç‹ç‚¸';
            } else if (playType === 'straight') {
                return `é¡ºå­ ${cards.length}å¼ `;
            }
            
            return `${cards.length}å¼ ç‰Œ`;
        }
        
        // æç¤ºåŠŸèƒ½
        function showHint() {
            if (gameState.gamePhase !== 'playing' || gameState.currentPlayer !== 'player') return;
            
            const hand = gameState.playerHand;
            let hintCards = [];
            
            if (gameState.lastPlayed && gameState.lastPlayer !== 'player') {
                // æœ‰ä¸Šå®¶å‡ºçš„ç‰Œï¼Œæç¤ºèƒ½å‹è¿‡çš„ç‰Œ
                hintCards = findPlayableCards(hand, gameState.lastPlayed);
            }
            
            if (hintCards.length === 0) {
                // æç¤ºå‡ºæœ€å°çš„å•å¼ 
                hintCards = [hand[0]];
            }
            
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            const selectedCards = playerHandElement.querySelectorAll('.card.selected');
            selectedCards.forEach(card => card.classList.remove('selected'));
            
            // é€‰æ‹©æç¤ºçš„ç‰Œ
            for (let card of hintCards) {
                const index = hand.indexOf(card);
                if (index !== -1) {
                    const cardElement = playerHandElement.querySelector(`.card[data-index="${index}"]`);
                    if (cardElement) {
                        cardElement.classList.add('selected');
                    }
                }
            }
            
            gameMessageElement.textContent = "å·²æç¤ºå¯å‡ºçš„ç‰Œ";
        }
        
        // æŠ˜å /å±•å¼€AIæ‰‹ç‰Œ
        function toggleAICards(aiPlayer) {
            const cardsArea = document.getElementById(`${aiPlayer}-cards`);
            const toggleButton = document.querySelector(`.toggle-cards[data-ai="${aiPlayer}"]`);
            
            if (cardsArea.classList.contains('folded')) {
                cardsArea.classList.remove('folded');
                toggleButton.textContent = 'æŠ˜å ';
            } else {
                cardsArea.classList.add('folded');
                toggleButton.textContent = 'å±•å¼€';
            }
        }
        
        // è€åƒç³»ç»Ÿ - è§£æè¾“å…¥çš„ç‰Œï¼ˆä¿®æ”¹ï¼šé»˜è®¤èŠ±è‰²ä¸ºçº¢æ¡ƒï¼‰
        function parseCardInput(input) {
            const inputStr = input.trim().toLowerCase();
            
            // å¤„ç†å¤§å°ç‹
            if (inputStr.includes('å°ç‹') || inputStr === 'å°ç‹') {
                return { value: 'å°ç‹', color: 'black', isJoker: true };
            }
            if (inputStr.includes('å¤§ç‹') || inputStr === 'å¤§ç‹') {
                return { value: 'å¤§ç‹', color: 'red', isJoker: true };
            }
            
            // è§£æèŠ±è‰²å’Œç‚¹æ•°
            let suit = null;
            let value = null;
            
            // å°è¯•åŒ¹é…ç‚¹æ•°
            for (let key in valueMap) {
                if (inputStr.includes(key.toLowerCase())) {
                    value = valueMap[key];
                    break;
                }
            }
            
            // å°è¯•åŒ¹é…èŠ±è‰²
            for (let key in suitMap) {
                if (inputStr.includes(key.toLowerCase())) {
                    suit = suitMap[key];
                    break;
                }
            }
            
            // å¦‚æœæ²¡æœ‰æŒ‡å®šèŠ±è‰²ï¼Œé»˜è®¤ä½¿ç”¨çº¢æ¡ƒ
            if (!suit && value) {
                suit = 'â™¥';
            }
            
            // å¦‚æœæ— æ³•è§£æï¼Œå°è¯•ç›´æ¥åŒ¹é…
            if (!suit || !value) {
                // å°è¯•ä»è¾“å…¥ä¸­æå–æ•°å­—å’ŒèŠ±è‰²
                const matches = inputStr.match(/([0-9JQKA2]+)([çº¢æ–¹æ¢…é»‘â™¥â™¦â™£â™ ])?/);
                if (matches && matches.length >= 2) {
                    value = matches[1];
                    suit = matches[2] ? (suitMap[matches[2]] || matches[2]) : 'â™¥'; // é»˜è®¤çº¢æ¡ƒ
                }
            }
            
            if (suit && value) {
                return {
                    suit: suit,
                    value: value,
                    color: (suit === 'â™¥' || suit === 'â™¦') ? 'red' : 'black'
                };
            }
            
            return null;
        }
        
        // è€åƒç³»ç»Ÿ - æ·»åŠ ç‰Œ
        function addCheatCard() {
            const input = cheatInputElement.value.trim();
            if (!input) return;
            
            const card = parseCardInput(input);
            if (card) {
                gameState.playerHand.push(card);
                sortHand(gameState.playerHand);
                updateUI();
                addLogEntry(`è€åƒç³»ç»Ÿï¼šæ·»åŠ äº† ${card.isJoker ? card.value : card.value + card.suit}`);
                cheatInputElement.value = '';
            } else {
                alert('æ— æ³•è¯†åˆ«çš„ç‰Œï¼Œè¯·ä½¿ç”¨æ ¼å¼å¦‚: å¤§ç‹, çº¢æ¡ƒA, é»‘æ¡ƒ2');
            }
        }
        
        // è€åƒç³»ç»Ÿ - æ˜¾ç¤º/éšè—
        function toggleCheatSystem() {
            if (cheatSystemElement.style.display === 'none') {
                cheatSystemElement.style.display = 'block';
                cheatToggleButton.textContent = 'éšè—è€åƒç³»ç»Ÿ';
            } else {
                cheatSystemElement.style.display = 'none';
                cheatToggleButton.textContent = 'æ˜¾ç¤ºè€åƒç³»ç»Ÿ';
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        document.getElementById('call-landlord').addEventListener('click', callLandlord);
        document.getElementById('play-cards').addEventListener('click', playCards);
        document.getElementById('pass-turn').addEventListener('click', passTurn);
        document.getElementById('hint').addEventListener('click', showHint);
        document.getElementById('restart').addEventListener('click', initGame);
        
        // AIå«åœ°ä¸»
        document.getElementById('call-landlord').addEventListener('click', function() {
            if (gameState.landlord) return;
            
            // å¦‚æœç©å®¶ä¸å«åœ°ä¸»ï¼ŒAIæœ‰æœºä¼šå«
            setTimeout(() => {
                if (!gameState.landlord) {
                    aiBid('ai1');
                }
            }, 1000);
        });
        
        // æŠ˜å æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.toggle-cards').forEach(button => {
            button.addEventListener('click', function() {
                toggleAICards(this.dataset.ai);
            });
        });
        
        // è€åƒç³»ç»Ÿäº‹ä»¶
        document.getElementById('cheat-add').addEventListener('click', addCheatCard);
        document.getElementById('cheat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addCheatCard();
            }
        });
        document.getElementById('show-cheat').addEventListener('click', toggleCheatSystem);
        document.getElementById('cheat-toggle').addEventListener('click', toggleCheatSystem);
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>
